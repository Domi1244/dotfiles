#!/usr/bin/env bash

# Check if bork repo exists
if [ ! -d bork/.git ]; then
    git clone https://github.com/mattly/bork.git
fi

# Check arguments
if [[ ( -z ${1} ) || ( "${1}" != "status" && "${1}" != "satisfy" ) ]]; then
    echo "Wrong argument. Run ./dotfiles status or ./dotfiles satisfy"
elif [ -z ${2} ]; then
    # If no 2nd argument => use bootstrap borkfile
    bork/bin/bork ${1} borkfiles/bootstrap.bork
else
    # Otherwise, install use the specific borkfile(s)
    COMMAND=${1}
    BORKFILES=${@:2}
    # For each specified borkfile
    for BORK in ${BORKFILES}; do
        if [[ -f borkfiles/${BORK}.bork ]]; then
            # Expand to actual path of borkfile, append to $BORKFILESTRING
            BORKFILESTRING+=" borkfiles/${BORK}.bork"
        else 
            echo "Error: couldn't find borkfile \"borkfiles/${BORK}.bork\""
        fi
    done
    # Check if we have found at least one valid borkfile
    if [[ -z $BORKFILESTRING ]]; then
        echo "Error: no valid borkfiles to process!"
    else
        # Execute $BORKFILESTRING 
        bork/bin/bork ${COMMAND} ${BORKFILESTRING}
    fi
fi